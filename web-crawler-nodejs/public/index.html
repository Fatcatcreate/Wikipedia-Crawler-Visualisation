<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Crawler Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css"
      rel="stylesheet"
    />
    <style>
      #mynetwork {
        width: 100%;
        height: 800px;
        border: 1px solid lightgray;
      }
    </style>
  </head>
  <body>
    <h2>Web Crawler Visualization</h2>
    <div id="mynetwork"></div>

    <script>
      // Fetch the pageLinkMapping.json file from the server
      fetch('pageLinkMapping.json')
        .then((response) => response.json())
        .then((pageLinkMapping) => {
          // Prepare the nodes and edges for Vis.js
          const nodes = [];
          const edges = [];

          // Map to store node ids
          const urlToIdMap = new Map();
          let idCounter = 1;

          // Helper function to extract the last meaningful part of the URL
          function extractLabel(url) {
            const urlObj = new URL(url);
            const pathname = urlObj.pathname;

            // Remove leading/trailing slashes and return the last part
            const segments = pathname.split('/').filter(Boolean); 
            return segments.length > 0 ? segments[segments.length - 1] : url;
          }

          // Helper function to add a node with extracted label
          function addNode(url) {
            if (!urlToIdMap.has(url)) {
              const label = extractLabel(url); // Get only the last part of the URL
              urlToIdMap.set(url, idCounter);
              nodes.push({ id: idCounter, label: label });
              idCounter++;
            }
            return urlToIdMap.get(url);
          }

          // Populate the graph data
          pageLinkMapping.forEach((pageData) => {
            const pageId = addNode(pageData.page);

            pageData.links.forEach((link) => {
              const linkId = addNode(link);
              edges.push({ from: pageId, to: linkId });
            });
          });

          // Optional: Highlight edges that represent the path followed by the crawler
          edges.forEach((edge) => {
            edge.color = "red"; // Highlight the crawl path in red
          });

          // Initialize the network
          const container = document.getElementById("mynetwork");
          const data = {
            nodes: new vis.DataSet(nodes),
            edges: new vis.DataSet(edges),
          };
          const options = {
            nodes: {
              shape: "dot",
              size: 16,
              font: {
                size: 14,
              },
            },
            edges: {
              arrows: { to: true },
              smooth: { type: "continuous" },
            },
            physics: {
              enabled: true,
            },
          };
          const network = new vis.Network(container, data, options);
        })
        .catch((error) => {
          console.error('Error loading pageLinkMapping.json:', error);
        });
    </script>
  </body>
</html> 